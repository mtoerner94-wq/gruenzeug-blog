---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: {
      category: post.data.categorySlug,
      id: post.id,
    },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const formattedDate = post.data.date.toLocaleDateString('de-DE', {
  day: 'numeric',
  month: 'long',
  year: 'numeric',
});
---

<BaseLayout
  title={`${post.data.title} – Grünzeug`}
  description={post.data.description}
  type="article"
>
  <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16">
    <!-- Breadcrumbs -->
    <nav class="text-sm text-slate-400 mb-8">
      <a href="/" class="hover:text-primary transition-colors">Startseite</a>
      <span class="mx-2">/</span>
      <a href={`/${post.data.categorySlug}/`} class="hover:text-primary transition-colors">
        {post.data.category}
      </a>
      <span class="mx-2">/</span>
      <span class="text-slate-600 line-clamp-1">{post.data.title}</span>
    </nav>

    <!-- Article Header -->
    <header class="mb-12">
      <span class="inline-block text-sm font-medium text-primary uppercase tracking-wider">
        {post.data.category}
      </span>
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-slate-900 mt-3 leading-tight">
        {post.data.title}
      </h1>
      <p class="text-lg text-slate-500 mt-4 leading-relaxed">
        {post.data.description}
      </p>
      <div class="flex items-center gap-4 mt-6 text-sm text-slate-400">
        <time datetime={post.data.date.toISOString()}>
          {formattedDate}
        </time>
        {post.data.updated && (
          <span>
            · Aktualisiert: {post.data.updated.toLocaleDateString('de-DE', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
            })}
          </span>
        )}
      </div>
    </header>

    <!-- Article Content -->
    <div class="prose prose-lg max-w-none prose-headings:font-semibold prose-headings:text-slate-900 prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-strong:text-slate-900 prose-img:rounded-xl">
      <Content />
    </div>

    <!-- Tags -->
    {post.data.tags.length > 0 && (
      <div class="mt-12 pt-8 border-t border-slate-200">
        <h3 class="text-sm font-semibold text-slate-900 uppercase tracking-wider mb-4">Tags</h3>
        <div class="flex flex-wrap gap-2">
          {post.data.tags.map((tag: string) => (
            <span class="text-sm bg-primary/10 text-primary px-4 py-1.5 rounded-full font-medium">
              {tag}
            </span>
          ))}
        </div>
      </div>
    )}

    <!-- Back Link -->
    <div class="mt-12 pt-8 border-t border-slate-200">
      <a
        href={`/${post.data.categorySlug}/`}
        class="inline-flex items-center gap-2 text-sm font-medium text-primary hover:text-primary-dark transition-colors"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
        Alle {post.data.category}-Artikel
      </a>
    </div>
  </article>
</BaseLayout>
